% generated by Ott 0.28 from: GTFL.ott
\newcommand{\ottdrule}[4][]{{\displaystyle\frac{\begin{array}{l}#2\end{array}}{#3}\quad\ottdrulename{#4}}}
\newcommand{\ottusedrule}[1]{\[#1\]}
\newcommand{\ottpremise}[1]{ #1 \\}
\newenvironment{ottdefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]}{}
\newenvironment{ottfundefnblock}[3][]{ \framebox{\mbox{#2}} \quad #3 \\[0pt]\begin{displaymath}\begin{array}{l}}{\end{array}\end{displaymath}}
\newcommand{\ottfunclause}[2]{ #1 \equiv #2 \\}
\newcommand{\ottnt}[1]{\mathit{#1}}
\newcommand{\ottmv}[1]{\mathit{#1}}
\newcommand{\ottkw}[1]{\mathbf{#1}}
\newcommand{\ottsym}[1]{#1}
\newcommand{\ottcom}[1]{\text{#1}}
\newcommand{\ottdrulename}[1]{\textsc{#1}}
\newcommand{\ottcomplu}[5]{\overline{#1}^{\,#2\in #3 #4 #5}}
\newcommand{\ottcompu}[3]{\overline{#1}^{\,#2<#3}}
\newcommand{\ottcomp}[2]{\overline{#1}^{\,#2}}
\newcommand{\ottgrammartabular}[1]{\begin{supertabular}{llcllllll}#1\end{supertabular}}
\newcommand{\ottmetavartabular}[1]{\begin{supertabular}{ll}#1\end{supertabular}}
\newcommand{\ottrulehead}[3]{$#1$ & & $#2$ & & & \multicolumn{2}{l}{#3}}
\newcommand{\ottprodline}[6]{& & $#1$ & $#2$ & $#3 #4$ & $#5$ & $#6$}
\newcommand{\ottfirstprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottlongprodline}[2]{& & $#1$ & \multicolumn{4}{l}{$#2$}}
\newcommand{\ottfirstlongprodline}[2]{\ottlongprodline{#1}{#2}}
\newcommand{\ottbindspecprodline}[6]{\ottprodline{#1}{#2}{#3}{#4}{#5}{#6}}
\newcommand{\ottprodnewline}{\\}
\newcommand{\ottinterrule}{\\[5.0mm]}
\newcommand{\ottafterlastrule}{\\}
\newcommand{\ottmetavars}{
\ottmetavartabular{
 $ \mathit{x} ,\, \mathit{y} ,\, \mathit{z} ,\, \mathit{c} $ & \ottcom{Symbols from some infinite set} \\
 $ i $ & \ottcom{Indices (ott artifact, please ignore)} \\
}}

\newcommand{\ottn}{
\ottrulehead{\ottnt{n}}{::=}{\ottcom{Natural Numbers}}}

\newcommand{\ottb}{
\ottrulehead{b}{::=}{\ottcom{Booleans}}\ottprodnewline
\ottfirstprodline{|}{\ottkw{true}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{false}}{}{}{}{}}

\newcommand{\otte}{
\ottrulehead{\source{e}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \blue{ \mathit{x} } }{}{}{}{\ottcom{Variables}}\ottprodnewline
\ottprodline{|}{ \blue{ b } }{}{}{}{\ottcom{Booleans}}\ottprodnewline
\ottprodline{|}{ \blue{ \ottnt{n} } }{}{}{}{\ottcom{Natural Numbers}}\ottprodnewline
\ottprodline{|}{ \blue{\lambda  \mathit{x} }  \ldotp  \source{e} }{}{}{}{\ottcom{Functions}}\ottprodnewline
\ottprodline{|}{ \source{e}_{{\mathrm{1}}} \  \source{e}_{{\mathrm{2}}} }{}{}{}{\ottcom{Function Application}}\ottprodnewline
\ottprodline{|}{ \source{e}_{{\mathrm{1}}}  \blue{\boldsymbol{+} }  \source{e}_{{\mathrm{2}}} }{}{}{}{\ottcom{Addition}}\ottprodnewline
\ottprodline{|}{ \source{e}_{{\mathrm{1}}}  \blue{\stackrel{?}{=} }  \source{e}_{{\mathrm{2}}} }{}{}{}{\ottcom{Number Equality Test}}\ottprodnewline
\ottprodline{|}{ \blue{\ottkw{if} }\  \source{e}_{{\mathrm{1}}} \ \blue{\ottkw{then} }\  \source{e}_{{\mathrm{2}}} \ \blue{\ottkw{else} }\  \source{e}_{{\mathrm{3}}} }{}{}{}{\ottcom{Conditionals}}\ottprodnewline
\ottprodline{|}{ \blue{\langle}  \source{e}_{{\mathrm{1}}}  \blue{,}  \source{e}_{{\mathrm{2}}}  \blue{\rangle} }{}{}{}{\ottcom{Tuples}}\ottprodnewline
\ottprodline{|}{ \blue{ \pi_1 }  \source{e} }{}{}{}{\ottcom{Tuple First Projection}}\ottprodnewline
\ottprodline{|}{ \blue{ \pi_2 }  \source{e} }{}{}{}{\ottcom{Tuple Second Projection}}\ottprodnewline
\ottprodline{|}{\source{ep} \, \source{e}}{}{}{}{\ottcom{Evidence Ascription}}\ottprodnewline
\ottprodline{|}{ \blue{ \ottkw{error} } }{}{}{}{\ottcom{Runtime Type Error}}}

\newcommand{\ottO}{
\ottrulehead{\ottnt{O}}{::=}{\ottcom{Observable values}}\ottprodnewline
\ottfirstprodline{|}{ \blue{ b } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{ \ottnt{n} } }{}{}{}{}}

\newcommand{\ottr}{
\ottrulehead{\source{r}}{::=}{\ottcom{Raw Irreducable (closed) terms}}\ottprodnewline
\ottfirstprodline{|}{ \blue{ b } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{ \ottnt{n} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{\lambda  \mathit{x} }  \ldotp  \source{e} }{}{}{}{\ottcom{Functions}}\ottprodnewline
\ottprodline{|}{ \blue{\langle}  \source{v}_{{\mathrm{1}}}  \blue{,}  \source{v}_{{\mathrm{2}}}  \blue{\rangle} }{}{}{}{}}

\newcommand{\ottv}{
\ottrulehead{\source{v}}{::=}{\ottcom{Irreducable (closed) terms}}\ottprodnewline
\ottfirstprodline{|}{\source{ep} \, \source{r}}{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{ b } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{ \ottnt{n} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{\lambda  \mathit{x} }  \ldotp  \source{e} }{}{}{}{\ottcom{Functions}}\ottprodnewline
\ottprodline{|}{ \blue{\langle}  \source{v}_{{\mathrm{1}}}  \blue{,}  \source{v}_{{\mathrm{2}}}  \blue{\rangle} }{}{}{}{}}

\newcommand{\ottep}{
\ottrulehead{\source{ep}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \blue{\llparenthesis }  \source{T}  \blue{\rrparenthesis} }{}{}{}{}}

\newcommand{\ottT}{
\ottrulehead{\source{T}}{::=}{\ottcom{Types}}\ottprodnewline
\ottfirstprodline{|}{ \blue{\mathsf{Nat} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{\mathsf{Bool} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \source{T}_{{\mathrm{1}}} \blue{\to} \source{T}_{{\mathrm{2}}} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \source{T}_{{\mathrm{1}}} \blue{\times} \source{T}_{{\mathrm{2}}} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{?} }{}{}{}{}}

\newcommand{\ottGamma}{
\ottrulehead{\blue{\Gamma}}{::=}{\ottcom{Environments}}\ottprodnewline
\ottfirstprodline{|}{ \blue{ \cdot } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \blue{\Gamma}  \blue{,( \mathit{x}  :}  \source{T}  \blue{)} }{}{}{}{}}

\newcommand{\ottC}{
\ottrulehead{\ottnt{C}}{::=}{\ottcom{Context Frames}}\ottprodnewline
\ottfirstprodline{|}{\square \, \source{e}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\source{v} \, \square}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(} \, \square \, \ottsym{,}  \source{e}  \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottsym{(}  \source{v}  \ottsym{,} \, \square \, \ottsym{)}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\pi_1 \, \square}{}{}{}{}\ottprodnewline
\ottprodline{|}{\pi_2 \, \square}{}{}{}{}\ottprodnewline
\ottprodline{|}{\source{ep} \, \square}{}{}{}{}\ottprodnewline
\ottprodline{|}{\square \, \ottsym{+}  \source{e}_{{\mathrm{1}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\source{v}  \ottsym{+} \, \square}{}{}{}{}\ottprodnewline
\ottprodline{|}{\square \, \stackrel{?}{=}  \source{e}_{{\mathrm{1}}}}{}{}{}{}\ottprodnewline
\ottprodline{|}{\source{v}  \stackrel{?}{=} \, \square}{}{}{}{}\ottprodnewline
\ottprodline{|}{\ottkw{if} \, \square \, \ottkw{then} \, \source{e}_{{\mathrm{1}}} \, \ottkw{else} \, \source{e}_{{\mathrm{2}}}}{}{}{}{}}

\newcommand{\ottu}{
\ottrulehead{\Ltarget{u}  ,\ \Ltarget{k}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \red{ \mathit{x} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{ \ottnt{n} } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{ b } }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{\ottkw{fix}\  \mathit{x} }\  \Ltarget{u} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{\lambda  \red{\mathrm{x}_\black{1} }\ldots \red{\mathrm{x}_\black{i} } }\ldotp  \Ltarget{t} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{\langle}  \Ltarget{u}_{{\mathrm{1}}}  \red{,}  \Ltarget{u}_{{\mathrm{2}}} \red{\rangle} }{}{}{}{}}

\newcommand{\ottvars}{
\ottrulehead{\red{\mathrm{x}_\black{1} }\ldots \red{\mathrm{x}_\black{i} }}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\mathit{x_{{\mathrm{1}}}} \, .. \, \mathit{x_{\ottmv{i}}}}{}{}{}{}}

\newcommand{\ottd}{
\ottrulehead{\Ltarget{d}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \red{ \mathit{x}  :=}  \Ltarget{u} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{ \mathit{x}  := \pi_1}  \Ltarget{u} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{ \mathit{x}  := \pi_2}  \Ltarget{u} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{ \mathit{x}  := }  \Ltarget{u}_{{\mathrm{1}}}  \red{+}  \Ltarget{u}_{{\mathrm{2}}} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{ \mathit{x}  := }  \Ltarget{u}_{{\mathrm{1}}}  \red{\stackrel{?}{=} }  \Ltarget{u}_{{\mathrm{2}}} }{}{}{}{}}

\newcommand{\ottt}{
\ottrulehead{\Ltarget{t}}{::=}{}\ottprodnewline
\ottfirstprodline{|}{ \red{\ottkw{let}\ }  \Ltarget{d}  \red{\ottkw{in}\ }  \Ltarget{t} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \Ltarget{u}  \red{(}  \red{\mathrm{u}_\black{1} } \ldots \red{\mathrm{u}_\black{i} }  \red{)} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{\ottkw{ if } }\  \Ltarget{u} \ \red{\ottkw{ then } }\  \Ltarget{t}_{{\mathrm{1}}} \ \red{ \ottkw{ else } }\  \Ltarget{t}_{{\mathrm{2}}} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{\ottkw{halt} [ }  \Ltarget{u}  \red{]} }{}{}{}{}\ottprodnewline
\ottprodline{|}{ \red{\ottkw{error} } }{}{}{}{}}

\newcommand{\ottarg}{
\ottrulehead{\red{\mathrm{u}_\black{1} } \ldots \red{\mathrm{u}_\black{i} }}{::=}{}\ottprodnewline
\ottfirstprodline{|}{\Ltarget{u}_{{\mathrm{1}}}  \ottsym{,} \, ... \, \ottsym{,}  \Ltarget{u}_{\ottmv{i}}}{}{}{}{}}

\newcommand{\ottgrammar}{\ottgrammartabular{
\ottn\ottinterrule
\ottb\ottinterrule
\otte\ottinterrule
\ottO\ottinterrule
\ottr\ottinterrule
\ottv\ottinterrule
\ottep\ottinterrule
\ottT\ottinterrule
\ottGamma\ottinterrule
\ottC\ottinterrule
\ottu\ottinterrule
\ottvars\ottinterrule
\ottd\ottinterrule
\ottt\ottinterrule
\ottarg\ottafterlastrule
}}

% defnss
% defns Semantics
%% defn Red
\newcommand{\ottdruleRedIfTrue}[1]{\ottdrule[#1]{%
}{
 \blue{\ottkw{if} }\   \blue{ \ottkw{true} }  \ \blue{\ottkw{then} }\  \source{e}_{{\mathrm{1}}} \ \blue{\ottkw{else} }\  \source{e}_{{\mathrm{2}}}   \longrightarrow  \source{e}_{{\mathrm{1}}}}{%
{\ottdrulename{RedIfTrue}}{}%
}}


\newcommand{\ottdruleRedIfFalse}[1]{\ottdrule[#1]{%
}{
 \blue{\ottkw{if} }\   \blue{ \ottkw{false} }  \ \blue{\ottkw{then} }\  \source{e}_{{\mathrm{1}}} \ \blue{\ottkw{else} }\  \source{e}_{{\mathrm{2}}}   \longrightarrow  \source{e}_{{\mathrm{2}}}}{%
{\ottdrulename{RedIfFalse}}{}%
}}


\newcommand{\ottdruleRedIfEv}[1]{\ottdrule[#1]{%
\ottpremise{ \blue{\ottkw{if} }\   \blue{ b }  \ \blue{\ottkw{then} }\  \source{e}_{{\mathrm{1}}} \ \blue{\ottkw{else} }\  \source{e}_{{\mathrm{2}}}   \longrightarrow  \source{e}}%
}{
 \blue{\ottkw{if} }\  \source{ep} \,  \blue{ b }  \ \blue{\ottkw{then} }\  \source{e}_{{\mathrm{1}}} \ \blue{\ottkw{else} }\  \source{e}_{{\mathrm{2}}}   \longrightarrow  \source{e}}{%
{\ottdrulename{RedIfEv}}{}%
}}


\newcommand{\ottdruleRedApp}[1]{\ottdrule[#1]{%
}{
 \blue{(}   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}   \blue{)}  \, \source{v}  \longrightarrow   \black{[}  \source{v}  \black{/}  \mathit{x}  \black{]}  \source{e} }{%
{\ottdrulename{RedApp}}{}%
}}


\newcommand{\ottdruleRedAppEv}[1]{\ottdrule[#1]{%
}{
 \blue{(}  \source{ep}_{{\mathrm{1}}} \,  \blue{(}   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}   \blue{)}   \blue{)}  \,  \blue{(}  \source{ep}_{{\mathrm{2}}} \, \source{r}  \blue{)}   \longrightarrow  \ottsym{(}  \ottkw{cod} \, \source{ep}_{{\mathrm{2}}}  \ottsym{)} \,  \blue{(}   \black{[}  \ottsym{(}  \ottkw{dom} \, \source{ep}_{{\mathrm{1}}}  \sqcap  \source{ep}_{{\mathrm{2}}}  \ottsym{)} \, \source{r}  \black{/}  \mathit{x}  \black{]}  \source{e}   \blue{)} }{%
{\ottdrulename{RedAppEv}}{}%
}}


\newcommand{\ottdruleRedAppEvFail}[1]{\ottdrule[#1]{%
\ottpremise{\ottkw{dom} \, \source{ep}_{{\mathrm{1}}}  \sqcap  \source{ep}_{{\mathrm{2}}} \, \ottkw{undefined}}%
}{
 \blue{(}  \source{ep}_{{\mathrm{1}}} \,  \blue{(}   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}   \blue{)}   \blue{)}  \,  \blue{(}  \source{ep}_{{\mathrm{2}}} \, \source{r}  \blue{)}   \longrightarrow   \blue{ \ottkw{error} } }{%
{\ottdrulename{RedAppEvFail}}{}%
}}


\newcommand{\ottdruleRedAppEvPartial}[1]{\ottdrule[#1]{%
}{
 \blue{(}  \source{ep} \,  \blue{(}   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}_{{\mathrm{1}}}   \blue{)}   \blue{)}  \, \source{r}  \longrightarrow  \ottsym{(}  \ottkw{cod} \, \source{ep}  \ottsym{)} \,  \blue{(}   \black{[}  \ottsym{(}  \ottkw{dom} \, \source{ep}  \ottsym{)} \, \source{e}_{{\mathrm{2}}}  \black{/}  \mathit{x}  \black{]}  \source{e}_{{\mathrm{1}}}   \blue{)} }{%
{\ottdrulename{RedAppEvPartial}}{}%
}}


\newcommand{\ottdruleRedAppEvPartialFail}[1]{\ottdrule[#1]{%
\ottpremise{\ottkw{dom} \, \source{ep} \, \ottkw{undefined}}%
}{
 \blue{(}  \source{ep} \,  \blue{(}   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}_{{\mathrm{1}}}   \blue{)}   \blue{)}  \, \source{v}  \longrightarrow   \blue{ \ottkw{error} } }{%
{\ottdrulename{RedAppEvPartialFail}}{}%
}}


\newcommand{\ottdruleRedPlus}[1]{\ottdrule[#1]{%
}{
  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\boldsymbol{+} }   \blue{ \ottnt{n_{{\mathrm{2}}}} }    \longrightarrow   \blue{  \ottnt{n_{{\mathrm{1}}}}  \black{+}  \ottnt{n_{{\mathrm{2}}}}  } }{%
{\ottdrulename{RedPlus}}{}%
}}


\newcommand{\ottdruleRedPlusEvL}[1]{\ottdrule[#1]{%
\ottpremise{  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\boldsymbol{+} }  \source{v}   \longrightarrow  \source{e}}%
}{
  \blue{(}  \source{ep} \,  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{)}   \blue{\boldsymbol{+} }  \source{v}   \longrightarrow  \source{e}}{%
{\ottdrulename{RedPlusEvL}}{}%
}}


\newcommand{\ottdruleRedPlusEvR}[1]{\ottdrule[#1]{%
\ottpremise{  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\boldsymbol{+} }   \blue{ \ottnt{n_{{\mathrm{2}}}} }    \longrightarrow  \source{e}}%
}{
  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\boldsymbol{+} }  \source{ep} \,  \blue{ \ottnt{n_{{\mathrm{2}}}} }    \longrightarrow  \source{e}}{%
{\ottdrulename{RedPlusEvR}}{}%
}}


\newcommand{\ottdruleRedEqT}[1]{\ottdrule[#1]{%
}{
  \blue{ \ottnt{n} }   \blue{\stackrel{?}{=} }   \blue{ \ottnt{n} }    \longrightarrow   \blue{ \ottkw{true} } }{%
{\ottdrulename{RedEqT}}{}%
}}


\newcommand{\ottdruleRedEqF}[1]{\ottdrule[#1]{%
\ottpremise{ \blue{ \ottnt{n_{{\mathrm{1}}}} }   \neq   \blue{ \ottnt{n_{{\mathrm{2}}}} } }%
}{
  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\stackrel{?}{=} }   \blue{ \ottnt{n_{{\mathrm{2}}}} }    \longrightarrow   \blue{ \ottkw{false} } }{%
{\ottdrulename{RedEqF}}{}%
}}


\newcommand{\ottdruleRedEqEvL}[1]{\ottdrule[#1]{%
\ottpremise{  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\stackrel{?}{=} }  \source{v}   \longrightarrow  \source{e}}%
}{
  \blue{(}  \source{ep} \,  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{)}   \blue{\stackrel{?}{=} }  \source{v}   \longrightarrow  \source{e}}{%
{\ottdrulename{RedEqEvL}}{}%
}}


\newcommand{\ottdruleRedEqEvR}[1]{\ottdrule[#1]{%
\ottpremise{  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\stackrel{?}{=} }   \blue{ \ottnt{n_{{\mathrm{2}}}} }    \longrightarrow  \source{e}}%
}{
  \blue{ \ottnt{n_{{\mathrm{1}}}} }   \blue{\stackrel{?}{=} }  \source{ep} \,  \blue{ \ottnt{n_{{\mathrm{2}}}} }    \longrightarrow  \source{e}}{%
{\ottdrulename{RedEqEvR}}{}%
}}


\newcommand{\ottdruleRedProj}[1]{\ottdrule[#1]{%
\ottpremise{i \, \in \, \ottsym{\{}  \ottsym{1}  \ottsym{,}  \ottsym{2}  \ottsym{\}}}%
}{
 \blue{ \pi_{ i } }   \blue{\langle}  \source{e}_{{\mathrm{1}}}  \blue{,}  \source{e}_{{\mathrm{2}}}  \blue{\rangle}    \longrightarrow  \source{e}_{\ottmv{i}}}{%
{\ottdrulename{RedProj}}{}%
}}


\newcommand{\ottdruleRedProjEv}[1]{\ottdrule[#1]{%
\ottpremise{i \, \in \, \ottsym{\{}  \ottsym{1}  \ottsym{,}  \ottsym{2}  \ottsym{\}}}%
}{
 \blue{ \pi_{ i } }   \blue{(}  \source{ep} \,  \blue{\langle}  \source{e}_{{\mathrm{1}}}  \blue{,}  \source{e}_{{\mathrm{2}}}  \blue{\rangle}   \blue{)}    \longrightarrow  \ottsym{(}   \ottkw{Proj}_{ i }  \source{ep}   \ottsym{)} \, \source{e}_{\ottmv{i}}}{%
{\ottdrulename{RedProjEv}}{}%
}}


\newcommand{\ottdruleRedProjFail}[1]{\ottdrule[#1]{%
\ottpremise{ \ottkw{Proj}_{ i }  \source{ep}  \, \ottkw{undefined}}%
}{
 \blue{ \pi_{ i } }   \blue{(}  \source{ep} \,  \blue{\langle}  \source{e}_{{\mathrm{1}}}  \blue{,}  \source{e}_{{\mathrm{2}}}  \blue{\rangle}   \blue{)}    \longrightarrow   \blue{ \ottkw{error} } }{%
{\ottdrulename{RedProjFail}}{}%
}}


\newcommand{\ottdruleRedAscr}[1]{\ottdrule[#1]{%
}{
\source{ep}_{{\mathrm{1}}} \,  \blue{(}  \source{ep}_{{\mathrm{2}}} \, \source{r}  \blue{)}   \longrightarrow  \ottsym{(}  \source{ep}_{{\mathrm{1}}}  \sqcap  \source{ep}_{{\mathrm{2}}}  \ottsym{)} \, \source{r}}{%
{\ottdrulename{RedAscr}}{}%
}}


\newcommand{\ottdruleRedAscrFail}[1]{\ottdrule[#1]{%
\ottpremise{\source{ep}_{{\mathrm{1}}}  \sqcap  \source{ep}_{{\mathrm{2}}} \, \ottkw{undefined}}%
}{
\source{ep}_{{\mathrm{1}}} \,  \blue{(}  \source{ep}_{{\mathrm{2}}} \, \source{r}  \blue{)}   \longrightarrow   \blue{ \ottkw{error} } }{%
{\ottdrulename{RedAscrFail}}{}%
}}


\newcommand{\ottdruleRedContext}[1]{\ottdrule[#1]{%
\ottpremise{\source{e}_{{\mathrm{1}}}  \longrightarrow  \source{e}_{{\mathrm{2}}}}%
}{
\ottnt{C}  \ottsym{[}  \source{e}_{{\mathrm{1}}}  \ottsym{]}  \longrightarrow  \ottnt{C}  \ottsym{[}  \source{e}_{{\mathrm{2}}}  \ottsym{]}}{%
{\ottdrulename{RedContext}}{}%
}}


\newcommand{\ottdruleRedContextFail}[1]{\ottdrule[#1]{%
\ottpremise{\source{e}  \longrightarrow   \blue{ \ottkw{error} } }%
}{
\ottnt{C}  \ottsym{[}  \source{e}  \ottsym{]}  \longrightarrow  \ottnt{C}  \ottsym{[}   \blue{ \ottkw{error} }   \ottsym{]}}{%
{\ottdrulename{RedContextFail}}{}%
}}

\newcommand{\ottdefnRed}[1]{\begin{ottdefnblock}[#1]{$\source{e}_{{\mathrm{1}}}  \longrightarrow  \source{e}_{{\mathrm{2}}}$}{\ottcom{Reduction Relation on terms}}
\ottusedrule{\ottdruleRedIfTrue{}}
\ottusedrule{\ottdruleRedIfFalse{}}
\ottusedrule{\ottdruleRedIfEv{}}
\ottusedrule{\ottdruleRedApp{}}
\ottusedrule{\ottdruleRedAppEv{}}
\ottusedrule{\ottdruleRedAppEvFail{}}
\ottusedrule{\ottdruleRedAppEvPartial{}}
\ottusedrule{\ottdruleRedAppEvPartialFail{}}
\ottusedrule{\ottdruleRedPlus{}}
\ottusedrule{\ottdruleRedPlusEvL{}}
\ottusedrule{\ottdruleRedPlusEvR{}}
\ottusedrule{\ottdruleRedEqT{}}
\ottusedrule{\ottdruleRedEqF{}}
\ottusedrule{\ottdruleRedEqEvL{}}
\ottusedrule{\ottdruleRedEqEvR{}}
\ottusedrule{\ottdruleRedProj{}}
\ottusedrule{\ottdruleRedProjEv{}}
\ottusedrule{\ottdruleRedProjFail{}}
\ottusedrule{\ottdruleRedAscr{}}
\ottusedrule{\ottdruleRedAscrFail{}}
\ottusedrule{\ottdruleRedContext{}}
\ottusedrule{\ottdruleRedContextFail{}}
\end{ottdefnblock}}


\newcommand{\ottdefnsSemantics}{
\ottdefnRed{}}

% defns Types
%% defn Hastype
\newcommand{\ottdruleHastypeVar}[1]{\ottdrule[#1]{%
\ottpremise{\ottsym{(}  \mathit{x}  \ottsym{:}  \source{T}  \ottsym{)} \, \in \, \blue{\Gamma}}%
}{
\blue{\Gamma}  \vdash   \blue{ \mathit{x} }   \ottsym{:}  \source{T}}{%
{\ottdrulename{HastypeVar}}{}%
}}


\newcommand{\ottdruleHastypeBool}[1]{\ottdrule[#1]{%
}{
\blue{\Gamma}  \vdash   \blue{ b }   \ottsym{:}   \blue{\mathsf{Bool} } }{%
{\ottdrulename{HastypeBool}}{}%
}}


\newcommand{\ottdruleHastypeNat}[1]{\ottdrule[#1]{%
}{
\blue{\Gamma}  \vdash   \blue{ \ottnt{n} }   \ottsym{:}   \blue{\mathsf{Nat} } }{%
{\ottdrulename{HastypeNat}}{}%
}}


\newcommand{\ottdruleHastypePlus}[1]{\ottdrule[#1]{%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{1}}}  \ottsym{:}   \blue{\mathsf{Nat} } }%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{2}}}  \ottsym{:}   \blue{\mathsf{Nat} } }%
}{
\blue{\Gamma}  \vdash   \source{e}_{{\mathrm{1}}}  \blue{\boldsymbol{+} }  \source{e}_{{\mathrm{2}}}   \ottsym{:}   \blue{\mathsf{Nat} } }{%
{\ottdrulename{HastypePlus}}{}%
}}


\newcommand{\ottdruleHastypeEq}[1]{\ottdrule[#1]{%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{1}}}  \ottsym{:}   \blue{\mathsf{Nat} } }%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{2}}}  \ottsym{:}   \blue{\mathsf{Nat} } }%
}{
\blue{\Gamma}  \vdash   \source{e}_{{\mathrm{1}}}  \blue{\stackrel{?}{=} }  \source{e}_{{\mathrm{2}}}   \ottsym{:}   \blue{\mathsf{Nat} } }{%
{\ottdrulename{HastypeEq}}{}%
}}


\newcommand{\ottdruleHastypeLam}[1]{\ottdrule[#1]{%
\ottpremise{ \blue{\Gamma}  \blue{,( \mathit{x}  :}  \source{T}_{{\mathrm{1}}}  \blue{)}   \vdash  \source{e}  \ottsym{:}  \source{T}_{{\mathrm{2}}}}%
}{
\blue{\Gamma}  \vdash   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}   \ottsym{:}   \source{T}_{{\mathrm{1}}} \blue{\to} \source{T}_{{\mathrm{2}}} }{%
{\ottdrulename{HastypeLam}}{}%
}}


\newcommand{\ottdruleHastypeApp}[1]{\ottdrule[#1]{%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{1}}}  \ottsym{:}   \source{T}_{{\mathrm{1}}} \blue{\to} \source{T}_{{\mathrm{2}}} }%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{2}}}  \ottsym{:}  \source{T}_{{\mathrm{1}}}}%
}{
\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{1}}} \, \source{e}_{{\mathrm{2}}}  \ottsym{:}  \source{T}_{{\mathrm{2}}}}{%
{\ottdrulename{HastypeApp}}{}%
}}


\newcommand{\ottdruleHastypeIf}[1]{\ottdrule[#1]{%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}  \ottsym{:}   \blue{\mathsf{Bool} } }%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{1}}}  \ottsym{:}  \source{T}}%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{2}}}  \ottsym{:}  \source{T}}%
}{
\blue{\Gamma}  \vdash   \blue{\ottkw{if} }\  \source{e} \ \blue{\ottkw{then} }\  \source{e}_{{\mathrm{1}}} \ \blue{\ottkw{else} }\  \source{e}_{{\mathrm{2}}}   \ottsym{:}  \source{T}}{%
{\ottdrulename{HastypeIf}}{}%
}}


\newcommand{\ottdruleHastypePair}[1]{\ottdrule[#1]{%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{1}}}  \ottsym{:}  \source{T}_{{\mathrm{1}}}}%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}_{{\mathrm{2}}}  \ottsym{:}  \source{T}_{{\mathrm{2}}}}%
}{
\blue{\Gamma}  \vdash   \blue{\langle}  \source{e}_{{\mathrm{1}}}  \blue{,}  \source{e}_{{\mathrm{2}}}  \blue{\rangle}   \ottsym{:}   \source{T}_{{\mathrm{1}}} \blue{\times} \source{T}_{{\mathrm{2}}} }{%
{\ottdrulename{HastypePair}}{}%
}}


\newcommand{\ottdruleHastypeProj}[1]{\ottdrule[#1]{%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}  \ottsym{:}   \source{T}_{{\mathrm{1}}} \blue{\times} \source{T}_{{\mathrm{2}}} }%
\ottpremise{i \, \in \, \ottsym{\{}  \ottsym{1}  \ottsym{,}  \ottsym{2}  \ottsym{\}}}%
}{
\blue{\Gamma}  \vdash    \blue{ \mathtt{ p } }  _\black{ i }  \, \source{e}  \ottsym{:}  \source{T}}{%
{\ottdrulename{HastypeProj}}{}%
}}


\newcommand{\ottdruleHastypeAscr}[1]{\ottdrule[#1]{%
\ottpremise{\blue{\Gamma}  \vdash  \source{e}  \ottsym{:}  \source{T}_{{\mathrm{2}}}}%
\ottpremise{\source{ep}  \vdash  \source{T}_{{\mathrm{1}}}  \cong  \source{T}_{{\mathrm{2}}}}%
}{
\blue{\Gamma}  \vdash  \source{ep} \, \source{e}  \ottsym{:}  \source{T}_{{\mathrm{1}}}}{%
{\ottdrulename{HastypeAscr}}{}%
}}

\newcommand{\ottdefnHastype}[1]{\begin{ottdefnblock}[#1]{$\blue{\Gamma}  \vdash  \source{e}  \ottsym{:}  \source{T}$}{\ottcom{Typability relation}}
\ottusedrule{\ottdruleHastypeVar{}}
\ottusedrule{\ottdruleHastypeBool{}}
\ottusedrule{\ottdruleHastypeNat{}}
\ottusedrule{\ottdruleHastypePlus{}}
\ottusedrule{\ottdruleHastypeEq{}}
\ottusedrule{\ottdruleHastypeLam{}}
\ottusedrule{\ottdruleHastypeApp{}}
\ottusedrule{\ottdruleHastypeIf{}}
\ottusedrule{\ottdruleHastypePair{}}
\ottusedrule{\ottdruleHastypeProj{}}
\ottusedrule{\ottdruleHastypeAscr{}}
\end{ottdefnblock}}

%% defn Consistent
\newcommand{\ottdruleConsistentEv}[1]{\ottdrule[#1]{%
\ottpremise{ \source{T}_{{\mathrm{3}}}  \sqcap  \source{T}_{{\mathrm{1}}}  =  \source{T}_{{\mathrm{3}}} }%
\ottpremise{ \source{T}_{{\mathrm{3}}}  \sqcap  \source{T}_{{\mathrm{2}}}  =  \source{T}_{{\mathrm{3}}} }%
}{
 \blue{\llparenthesis }  \source{T}_{{\mathrm{3}}}  \blue{\rrparenthesis}   \vdash  \source{T}_{{\mathrm{1}}}  \cong  \source{T}_{{\mathrm{2}}}}{%
{\ottdrulename{ConsistentEv}}{}%
}}

\newcommand{\ottdefnConsistent}[1]{\begin{ottdefnblock}[#1]{$\source{ep}  \vdash  \source{T}_{{\mathrm{1}}}  \cong  \source{T}_{{\mathrm{2}}}$}{\ottcom{Type Consistency relative to Evidence}}
\ottusedrule{\ottdruleConsistentEv{}}
\end{ottdefnblock}}

%% defn Meet
\newcommand{\ottdruleMeetDynL}[1]{\ottdrule[#1]{%
}{
  \blue{?}   \sqcap  \source{T}  =  \source{T} }{%
{\ottdrulename{MeetDynL}}{}%
}}


\newcommand{\ottdruleMeetDynR}[1]{\ottdrule[#1]{%
}{
 \source{T}  \sqcap   \blue{?}   =  \source{T} }{%
{\ottdrulename{MeetDynR}}{}%
}}


\newcommand{\ottdruleMeetRefl}[1]{\ottdrule[#1]{%
}{
 \source{T}  \sqcap  \source{T}  =  \source{T} }{%
{\ottdrulename{MeetRefl}}{}%
}}


\newcommand{\ottdruleMeetFun}[1]{\ottdrule[#1]{%
\ottpremise{ \source{T}_{{\mathrm{1}}}  \sqcap  \source{T}'_{{\mathrm{1}}}  =  \source{T}''_{{\mathrm{1}}} }%
\ottpremise{ \source{T}_{{\mathrm{2}}}  \sqcap  \source{T}'_{{\mathrm{2}}}  =  \source{T}''_{{\mathrm{2}}} }%
}{
  \source{T}_{{\mathrm{1}}} \blue{\to} \source{T}_{{\mathrm{2}}}   \sqcap   \source{T}'_{{\mathrm{1}}} \blue{\to} \source{T}'_{{\mathrm{2}}}   =   \source{T}''_{{\mathrm{1}}} \blue{\to} \source{T}''_{{\mathrm{2}}}  }{%
{\ottdrulename{MeetFun}}{}%
}}


\newcommand{\ottdruleMeetProd}[1]{\ottdrule[#1]{%
\ottpremise{ \source{T}_{{\mathrm{1}}}  \sqcap  \source{T}'_{{\mathrm{1}}}  =  \source{T}''_{{\mathrm{1}}} }%
\ottpremise{ \source{T}_{{\mathrm{2}}}  \sqcap  \source{T}'_{{\mathrm{2}}}  =  \source{T}''_{{\mathrm{2}}} }%
}{
  \source{T}_{{\mathrm{1}}} \blue{\times} \source{T}_{{\mathrm{2}}}   \sqcap   \source{T}'_{{\mathrm{1}}} \blue{\times} \source{T}'_{{\mathrm{2}}}   =   \source{T}''_{{\mathrm{1}}} \blue{\times} \source{T}''_{{\mathrm{2}}}  }{%
{\ottdrulename{MeetProd}}{}%
}}

\newcommand{\ottdefnMeet}[1]{\begin{ottdefnblock}[#1]{$ \source{T}_{{\mathrm{1}}}  \sqcap  \source{T}_{{\mathrm{2}}}  =  \source{T}_{{\mathrm{3}}} $}{\ottcom{Precision Meet}}
\ottusedrule{\ottdruleMeetDynL{}}
\ottusedrule{\ottdruleMeetDynR{}}
\ottusedrule{\ottdruleMeetRefl{}}
\ottusedrule{\ottdruleMeetFun{}}
\ottusedrule{\ottdruleMeetProd{}}
\end{ottdefnblock}}

%% defn ValTransform
\newcommand{\ottdruleValTransformBool}[1]{\ottdrule[#1]{%
}{
 \mathcal{V}\llbracket   \blue{ b }   \rrbracket =   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{ b }  \red{\rangle}  }{%
{\ottdrulename{ValTransformBool}}{}%
}}


\newcommand{\ottdruleValTransformNum}[1]{\ottdrule[#1]{%
}{
 \mathcal{V}\llbracket   \blue{ \ottnt{n} }   \rrbracket =   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{ \ottnt{n} }  \red{\rangle}  }{%
{\ottdrulename{ValTransformNum}}{}%
}}


\newcommand{\ottdruleValTransformFun}[1]{\ottdrule[#1]{%
\ottpremise{ \mathcal{E}\llbracket  \source{e}  \rrbracket   \red{ \mathit{c} }   =  \Ltarget{t} }%
}{
 \mathcal{V}\llbracket   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}   \rrbracket =   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{\lambda  \mathit{x} \, \mathit{c} }\ldotp  \Ltarget{t}  \red{\rangle}  }{%
{\ottdrulename{ValTransformFun}}{}%
}}


\newcommand{\ottdruleValTransformPair}[1]{\ottdrule[#1]{%
}{
 \mathcal{V}\llbracket   \blue{\langle}  \source{v}_{{\mathrm{1}}}  \blue{,}  \source{v}_{{\mathrm{2}}}  \blue{\rangle}   \rrbracket =   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{\langle}   \black{\mathcal{V}\llbracket }  \source{v}_{{\mathrm{1}}}  \black{\rrbracket}   \red{,}   \black{\mathcal{V}\llbracket }  \source{v}_{{\mathrm{2}}}  \black{\rrbracket}  \red{\rangle}  \red{\rangle}  }{%
{\ottdrulename{ValTransformPair}}{}%
}}


\newcommand{\ottdruleValTransformEv}[1]{\ottdrule[#1]{%
\ottpremise{ \mathcal{V}\llbracket  \source{r}  \rrbracket =   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}  \Ltarget{u} \red{\rangle}  }%
}{
 \mathcal{V}\llbracket  \source{ep} \, \source{r}  \rrbracket =   \red{\langle}   \black{\mathcal{T} \llbracket}  \source{ep}  \black{\rrbracket}   \red{,}  \Ltarget{u} \red{\rangle}  }{%
{\ottdrulename{ValTransformEv}}{}%
}}

\newcommand{\ottdefnValTransform}[1]{\begin{ottdefnblock}[#1]{$ \mathcal{V}\llbracket  \source{v}  \rrbracket =  \Ltarget{u} $}{\ottcom{CPS Translation of Closed Values}}
\ottusedrule{\ottdruleValTransformBool{}}
\ottusedrule{\ottdruleValTransformNum{}}
\ottusedrule{\ottdruleValTransformFun{}}
\ottusedrule{\ottdruleValTransformPair{}}
\ottusedrule{\ottdruleValTransformEv{}}
\end{ottdefnblock}}

%% defn Transform
\newcommand{\ottdruleTransformVar}[1]{\ottdrule[#1]{%
}{
 \mathcal{E}\llbracket   \blue{ \mathit{x} }   \rrbracket  \Ltarget{k}  =   \Ltarget{k}  \red{(}   \red{ \mathit{x} }   \red{)}  }{%
{\ottdrulename{TransformVar}}{}%
}}


\newcommand{\ottdruleTransformBool}[1]{\ottdrule[#1]{%
}{
 \mathcal{E}\llbracket   \blue{ b }   \rrbracket  \Ltarget{k}  =   \Ltarget{k}  \red{(}   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{ b }  \red{\rangle}   \red{)}  }{%
{\ottdrulename{TransformBool}}{}%
}}


\newcommand{\ottdruleTransformNum}[1]{\ottdrule[#1]{%
}{
 \mathcal{E}\llbracket   \blue{ \ottnt{n} }   \rrbracket  \Ltarget{k}  =   \Ltarget{k}  \red{(}   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{ \ottnt{n} }  \red{\rangle}   \red{)}  }{%
{\ottdrulename{TransformNum}}{}%
}}


\newcommand{\ottdruleTransformFun}[1]{\ottdrule[#1]{%
\ottpremise{ \mathcal{E}\llbracket  \source{e}  \rrbracket   \red{ \mathit{c} }   =  \Ltarget{t} }%
}{
 \mathcal{E}\llbracket   \blue{(}   \blue{\lambda  \mathit{x} }  \ldotp  \source{e}   \blue{)}   \rrbracket  \Ltarget{k}  =   \Ltarget{k}  \red{(}   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{\lambda  \mathit{x} \, \mathit{c} }\ldotp  \Ltarget{t}  \red{\rangle}   \red{)}  }{%
{\ottdrulename{TransformFun}}{}%
}}


\newcommand{\ottdruleTransformApp}[1]{\ottdrule[#1]{%
\ottpremise{\Ltarget{k}_{{\mathrm{1}}}  \ottsym{:=}   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{2}}}} }\ldotp   \red{\ottkw{let}\ }   \red{ \mathit{y_{{\mathrm{1}}}}  := \pi_1}   \red{ \mathit{x_{{\mathrm{1}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{1}}}}  := \pi_2}   \red{ \mathit{x_{{\mathrm{1}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{y_{{\mathrm{2}}}}  := \pi_1}   \red{ \mathit{x_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{2}}}}  := \pi_2}   \red{ \mathit{x_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }  \Ltarget{t}_{{\mathrm{1}}}       \red{)} }%
\ottpremise{\Ltarget{t}_{{\mathrm{1}}}  \ottsym{:=}    \red{\mathtt{DOM } }   \red{(}   \red{ \mathit{y_{{\mathrm{1}}}} }   \ottsym{,}   \red{\lambda  \mathit{y'_{{\mathrm{1}}}} }\ldotp    \red{\mathtt{COD } }   \red{(}   \red{ \mathit{y_{{\mathrm{1}}}} }   \ottsym{,}   \red{\lambda  \mathit{y''_{{\mathrm{1}}}} }\ldotp    \red{\mathtt{MEET } }   \red{(}   \red{ \mathit{y'_{{\mathrm{1}}}} }   \ottsym{,}   \red{ \mathit{y_{{\mathrm{2}}}} }   \ottsym{,}   \red{(}   \red{\lambda  \mathit{y_{{\mathrm{3}}}} }\ldotp    \red{ \mathit{z_{{\mathrm{1}}}} }   \red{(}   \red{\langle}   \red{ \mathit{y_{{\mathrm{3}}}} }   \red{,}   \red{ \mathit{z_{{\mathrm{2}}}} }  \red{\rangle}   \ottsym{,}   \red{(}   \red{\lambda  \mathit{z_{{\mathrm{3}}}} }\ldotp  \Ltarget{t}_{{\mathrm{2}}}   \red{)}   \red{)}    \red{)}   \red{)}    \red{)}    \red{)} }%
\ottpremise{\Ltarget{t}_{{\mathrm{2}}}  \ottsym{:=}   \red{\ottkw{let}\ }   \red{ \mathit{z'_{{\mathrm{3}}}}  := \pi_1}   \red{ \mathit{z_{{\mathrm{3}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z''_{{\mathrm{3}}}}  := \pi_2}   \red{ \mathit{z_{{\mathrm{3}}}} }    \red{\ottkw{in}\ }    \red{\mathtt{MEET } }   \red{(}   \red{ \mathit{y''_{{\mathrm{1}}}} }   \ottsym{,}   \red{ \mathit{z'_{{\mathrm{3}}}} }   \ottsym{,}   \red{(}   \red{\lambda  \mathit{z_{{\mathrm{4}}}} }\ldotp   \Ltarget{k}  \red{(}   \red{\langle}   \red{ \mathit{z_{{\mathrm{4}}}} }   \red{,}   \red{ \mathit{z''_{{\mathrm{3}}}} }  \red{\rangle}   \red{)}    \red{)}   \red{)}   }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{2}}}  \rrbracket  \Ltarget{k}_{{\mathrm{1}}}  =  \Ltarget{t}' }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{1}}}  \rrbracket   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{1}}}} }\ldotp  \Ltarget{t}'   \red{)}   =  \Ltarget{t} }%
}{
 \mathcal{E}\llbracket  \source{e}_{{\mathrm{1}}} \, \source{e}_{{\mathrm{2}}}  \rrbracket  \Ltarget{k}  =  \Ltarget{t} }{%
{\ottdrulename{TransformApp}}{}%
}}


\newcommand{\ottdruleTransformPlus}[1]{\ottdrule[#1]{%
\ottpremise{\Ltarget{k}_{{\mathrm{1}}}  \ottsym{:=}   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{2}}}} }\ldotp   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{1}}}}  := \pi_2}   \red{ \mathit{x_{{\mathrm{1}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{2}}}}  := \pi_2}   \red{ \mathit{x_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{3}}}}  := }   \red{ \mathit{z_{{\mathrm{1}}}} }   \red{+}   \red{ \mathit{z_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }   \Ltarget{k}  \red{(}   \red{ \mathit{z_{{\mathrm{3}}}} }   \red{)}       \red{)} }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{2}}}  \rrbracket  \Ltarget{k}_{{\mathrm{1}}}  =  \Ltarget{t}' }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{1}}}  \rrbracket   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{1}}}} }\ldotp  \Ltarget{t}'   \red{)}   =  \Ltarget{t} }%
}{
 \mathcal{E}\llbracket   \source{e}_{{\mathrm{1}}}  \blue{\boldsymbol{+} }  \source{e}_{{\mathrm{2}}}   \rrbracket  \Ltarget{k}  =  \Ltarget{t} }{%
{\ottdrulename{TransformPlus}}{}%
}}


\newcommand{\ottdruleTransformEq}[1]{\ottdrule[#1]{%
\ottpremise{\Ltarget{k}_{{\mathrm{1}}}  \ottsym{:=}   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{2}}}} }\ldotp   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{1}}}}  := \pi_2}   \red{ \mathit{x_{{\mathrm{1}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{2}}}}  := \pi_2}   \red{ \mathit{x_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{3}}}}  := }   \red{ \mathit{z_{{\mathrm{1}}}} }   \red{\stackrel{?}{=} }   \red{ \mathit{z_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }   \Ltarget{k}  \red{(}   \red{ \mathit{z_{{\mathrm{3}}}} }   \red{)}       \red{)} }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{2}}}  \rrbracket  \Ltarget{k}_{{\mathrm{1}}}  =  \Ltarget{t}' }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{1}}}  \rrbracket   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{1}}}} }\ldotp  \Ltarget{t}'   \red{)}   =  \Ltarget{t} }%
}{
 \mathcal{E}\llbracket   \source{e}_{{\mathrm{1}}}  \blue{\boldsymbol{+} }  \source{e}_{{\mathrm{2}}}   \rrbracket  \Ltarget{k}  =  \Ltarget{t} }{%
{\ottdrulename{TransformEq}}{}%
}}


\newcommand{\ottdruleTransformPair}[1]{\ottdrule[#1]{%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{2}}}  \rrbracket   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{2}}}} }\ldotp   \Ltarget{k}  \red{(}   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{\langle}   \red{ \mathit{x_{{\mathrm{1}}}} }   \red{,}   \red{ \mathit{x_{{\mathrm{2}}}} }  \red{\rangle}  \red{\rangle}   \red{)}    \red{)}   =  \Ltarget{t}' }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{1}}}  \rrbracket   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{1}}}} }\ldotp  \Ltarget{t}'   \red{)}   =  \Ltarget{t} }%
}{
 \mathcal{E}\llbracket   \blue{\langle}  \source{e}_{{\mathrm{1}}}  \blue{,}  \source{e}_{{\mathrm{2}}}  \blue{\rangle}   \rrbracket  \Ltarget{k}  =  \Ltarget{t} }{%
{\ottdrulename{TransformPair}}{}%
}}


\newcommand{\ottdruleTransformIf}[1]{\ottdrule[#1]{%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{1}}}  \rrbracket  \Ltarget{k}  =  \Ltarget{t}_{{\mathrm{1}}} }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{2}}}  \rrbracket  \Ltarget{k}  =  \Ltarget{t}_{{\mathrm{2}}} }%
\ottpremise{ \mathcal{E}\llbracket  \source{e}_{{\mathrm{0}}}  \rrbracket   \red{(}   \red{\lambda  \mathit{x_{{\mathrm{0}}}} }\ldotp   \red{\ottkw{let}\ }   \red{ \mathit{x}  := \pi_2}   \red{ \mathit{x_{{\mathrm{0}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{ if } }\   \red{ \mathit{x} }  \ \red{\ottkw{ then } }\  \Ltarget{t}_{{\mathrm{1}}} \ \red{ \ottkw{ else } }\  \Ltarget{t}_{{\mathrm{2}}}     \red{)}   =  \Ltarget{t} }%
}{
 \mathcal{E}\llbracket   \blue{\ottkw{if} }\  \source{e}_{{\mathrm{0}}} \ \blue{\ottkw{then} }\  \source{e}_{{\mathrm{1}}} \ \blue{\ottkw{else} }\  \source{e}_{{\mathrm{2}}}   \rrbracket  \Ltarget{k}  =  \Ltarget{t} }{%
{\ottdrulename{TransformIf}}{}%
}}


\newcommand{\ottdruleTransformProj}[1]{\ottdrule[#1]{%
\ottpremise{ \mathcal{E}\llbracket  \source{e}  \rrbracket   \red{(}   \red{\lambda  \mathit{x} }\ldotp   \red{\ottkw{let}\ }   \red{ \mathit{y_{{\mathrm{1}}}}  := \pi_1}   \red{ \mathit{x} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{y_{{\mathrm{2}}}}  := \pi_2}   \red{ \mathit{x} }    \red{\ottkw{in}\ }    \red{ \mathtt{PROD}_\black{ i } }   \red{(}   \red{ \mathit{y_{{\mathrm{1}}}} }   \ottsym{,}  \Ltarget{k}'  \red{)}      \red{)}   =  \Ltarget{t} }%
\ottpremise{\Ltarget{k}'  \ottsym{:=}   \red{(}   \red{\lambda  \mathit{z_{{\mathrm{1}}}} }\ldotp   \red{\ottkw{let}\ }   \mathit{z_{{\mathrm{2}}}}  := \red{\pi}_\black{ i }\   \red{ \mathit{y} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{21}}}}  := \pi_1}   \red{ \mathit{z_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{z_{{\mathrm{22}}}}  := \pi_2}   \red{ \mathit{z_{{\mathrm{2}}}} }    \red{\ottkw{in}\ }    \red{\mathtt{MEET } }   \red{(}   \red{ \mathit{z_{{\mathrm{1}}}} }   \ottsym{,}   \red{ \mathit{z_{{\mathrm{21}}}} }   \ottsym{,}   \red{(}   \red{\lambda  \mathit{z'_{{\mathrm{1}}}} }\ldotp   \Ltarget{k}  \red{(}   \red{\langle}   \red{ \mathit{z'_{{\mathrm{1}}}} }   \red{,}   \red{ \mathit{z_{{\mathrm{22}}}} }  \red{\rangle}   \red{)}    \red{)}   \red{)}       \red{)} }%
}{
 \mathcal{E}\llbracket   \blue{ \pi_{ i } }  \source{e}   \rrbracket  \Ltarget{k}  =  \Ltarget{t} }{%
{\ottdrulename{TransformProj}}{}%
}}


\newcommand{\ottdruleTransformEv}[1]{\ottdrule[#1]{%
\ottpremise{ \mathcal{E}\llbracket  \source{e}  \rrbracket   \red{(}   \red{\lambda  \mathit{x} }\ldotp   \red{\ottkw{let}\ }   \red{ \mathit{x_{{\mathrm{1}}}}  := \pi_1}   \red{ \mathit{x} }    \red{\ottkw{in}\ }   \red{\ottkw{let}\ }   \red{ \mathit{x_{{\mathrm{2}}}}  := \pi_2}   \red{ \mathit{x} }    \red{\ottkw{in}\ }    \red{\mathtt{MEET } }   \red{(}   \black{\mathcal{T} \llbracket}  \source{ep}  \black{\rrbracket}   \ottsym{,}   \red{ \mathit{x_{{\mathrm{1}}}} }   \ottsym{,}   \red{(}   \red{\lambda  \mathit{y} }\ldotp   \Ltarget{k}  \red{(}   \red{\langle}   \red{ \mathit{y} }   \red{,}   \red{ \mathit{x_{{\mathrm{2}}}} }  \red{\rangle}   \red{)}    \red{)}   \red{)}      \red{)}   =  \Ltarget{t} }%
}{
 \mathcal{E}\llbracket  \source{ep} \, \source{e}  \rrbracket  \Ltarget{k}  =  \Ltarget{t} }{%
{\ottdrulename{TransformEv}}{}%
}}


\newcommand{\ottdruleTransformErr}[1]{\ottdrule[#1]{%
}{
 \mathcal{E}\llbracket   \blue{ \ottkw{error} }   \rrbracket  \Ltarget{k}  =   \red{\ottkw{error} }  }{%
{\ottdrulename{TransformErr}}{}%
}}

\newcommand{\ottdefnTransform}[1]{\begin{ottdefnblock}[#1]{$ \mathcal{E}\llbracket  \source{e}  \rrbracket  \Ltarget{k}  =  \Ltarget{t} $}{\ottcom{CPS Translation of Expressions}}
\ottusedrule{\ottdruleTransformVar{}}
\ottusedrule{\ottdruleTransformBool{}}
\ottusedrule{\ottdruleTransformNum{}}
\ottusedrule{\ottdruleTransformFun{}}
\ottusedrule{\ottdruleTransformApp{}}
\ottusedrule{\ottdruleTransformPlus{}}
\ottusedrule{\ottdruleTransformEq{}}
\ottusedrule{\ottdruleTransformPair{}}
\ottusedrule{\ottdruleTransformIf{}}
\ottusedrule{\ottdruleTransformProj{}}
\ottusedrule{\ottdruleTransformEv{}}
\ottusedrule{\ottdruleTransformErr{}}
\end{ottdefnblock}}

%% defn EvTransform
\newcommand{\ottdruleEvTransformBool}[1]{\ottdrule[#1]{%
}{
 \mathcal{T}\llbracket   \blue{\llparenthesis }   \blue{\mathsf{Bool} }   \blue{\rrparenthesis}   \rrbracket =   \red{\langle}   \red{  \red{\mathtt{BOOL } }  }   \red{,}   \red{ \ottsym{0} }  \red{\rangle}  }{%
{\ottdrulename{EvTransformBool}}{}%
}}


\newcommand{\ottdruleEvTransformNat}[1]{\ottdrule[#1]{%
}{
 \mathcal{T}\llbracket   \blue{\llparenthesis }   \blue{\mathsf{Nat} }   \blue{\rrparenthesis}   \rrbracket =   \red{\langle}   \red{  \red{\mathtt{NAT } }  }   \red{,}   \red{ \ottsym{0} }  \red{\rangle}  }{%
{\ottdrulename{EvTransformNat}}{}%
}}


\newcommand{\ottdruleEvTransformDyn}[1]{\ottdrule[#1]{%
}{
 \mathcal{T}\llbracket   \blue{\llparenthesis }   \blue{?}   \blue{\rrparenthesis}   \rrbracket =   \red{\langle}   \red{  \mathtt{ DYN }  }   \red{,}   \red{ \ottsym{0} }  \red{\rangle}  }{%
{\ottdrulename{EvTransformDyn}}{}%
}}


\newcommand{\ottdruleEvTransformArr}[1]{\ottdrule[#1]{%
}{
 \mathcal{T}\llbracket   \blue{\llparenthesis }   \source{T}_{{\mathrm{1}}} \blue{\to} \source{T}_{{\mathrm{2}}}   \blue{\rrparenthesis}   \rrbracket =   \red{\langle}   \red{  \red{ \mathtt{ARROW } }  }   \red{,}   \red{\langle}   \black{\mathcal{T} \llbracket}   \blue{\llparenthesis }  \source{T}_{{\mathrm{1}}}  \blue{\rrparenthesis}   \black{\rrbracket}   \red{,}   \black{\mathcal{T} \llbracket}   \blue{\llparenthesis }  \source{T}_{{\mathrm{2}}}  \blue{\rrparenthesis}   \black{\rrbracket}  \red{\rangle}  \red{\rangle}  }{%
{\ottdrulename{EvTransformArr}}{}%
}}


\newcommand{\ottdruleEvTransformProd}[1]{\ottdrule[#1]{%
}{
 \mathcal{T}\llbracket   \blue{\llparenthesis }   \source{T}_{{\mathrm{1}}} \blue{\to} \source{T}_{{\mathrm{2}}}   \blue{\rrparenthesis}   \rrbracket =   \red{\langle}   \red{  \red{ \mathtt{PRODUCT } }  }   \red{,}   \red{\langle}   \black{\mathcal{T} \llbracket}   \blue{\llparenthesis }  \source{T}_{{\mathrm{1}}}  \blue{\rrparenthesis}   \black{\rrbracket}   \red{,}   \black{\mathcal{T} \llbracket}   \blue{\llparenthesis }  \source{T}_{{\mathrm{2}}}  \blue{\rrparenthesis}   \black{\rrbracket}  \red{\rangle}  \red{\rangle}  }{%
{\ottdrulename{EvTransformProd}}{}%
}}

\newcommand{\ottdefnEvTransform}[1]{\begin{ottdefnblock}[#1]{$ \mathcal{T}\llbracket  \source{ep}  \rrbracket =  \Ltarget{u} $}{\ottcom{CPS Representation of Runtime Evidence}}
\ottusedrule{\ottdruleEvTransformBool{}}
\ottusedrule{\ottdruleEvTransformNat{}}
\ottusedrule{\ottdruleEvTransformDyn{}}
\ottusedrule{\ottdruleEvTransformArr{}}
\ottusedrule{\ottdruleEvTransformProd{}}
\end{ottdefnblock}}

%% defn KStep

\newcommand{\ottdefnKStep}[1]{\begin{ottdefnblock}[#1]{$\Ltarget{t}_{{\mathrm{1}}}  {\longrightarrow^{*} }  \Ltarget{t}_{{\mathrm{2}}}$}{}
\end{ottdefnblock}}


\newcommand{\ottdefnsTypes}{
\ottdefnHastype{}\ottdefnConsistent{}\ottdefnMeet{}\ottdefnValTransform{}\ottdefnTransform{}\ottdefnEvTransform{}\ottdefnKStep{}}

\newcommand{\ottdefnss}{
\ottdefnsSemantics
\ottdefnsTypes
}

\newcommand{\ottall}{\ottmetavars\\[0pt]
\ottgrammar\\[5.0mm]





\ottdefnss

\ottdefnss}

